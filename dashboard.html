<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم البورتفوليو</title>
  <style>
    :root { --bg: #faf7f4; --primary: #007bff; --text: #333; --sideW: 280px; --trans: .3s ease; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
    .container { display: flex; min-height: 100vh; }
    aside.sidebar { width: var(--sideW); background: var(--primary); color: #fff; padding: 2rem 1rem; position: fixed; right: 0; top: 0; bottom: 0; overflow-y: auto; transition: transform var(--trans); }
    .mobile-menu { display: none; position: fixed; top: 1rem; right: 1rem; background: var(--primary); border: none; color: #fff; padding: .5rem; border-radius: 4px; font-size: 1.5rem; z-index: 1000; }
    aside h2 { font-size: 1.5rem; margin-bottom: 1.5rem; }
    aside ul { list-style: none; }
    aside li { margin-bottom: .5rem; position: relative; }
    aside a { color: #fff; text-decoration: none; font-size: 1.1rem; padding: .5rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    aside a:hover { background: rgba(255,255,255,0.2); }
    .has-sub > span { transition: transform var(--trans); }
    .submenu { position: absolute; left: 0; top: 100%; background: var(--primary); width: 100%; max-height: 0; overflow: hidden; transition: max-height var(--trans); z-index: 10; }
    .submenu a { display: block; padding: .5rem 1rem; font-size: 1rem; }
    main { flex: 1; margin-right: var(--sideW); padding: 2rem; transition: margin-right var(--trans); }
    section { margin-bottom: 3rem; display: none; }
    .section-title { font-size: 1.8rem; margin-bottom: 1rem; border-bottom: 3px solid var(--primary); display: inline-block; }
    .stats { display: grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap: 1.5rem; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: .5rem; }
    input, select, textarea, button { width: 100%; padding: .6rem; border: 1px solid #ccc; border-radius: 4px; margin-top: .2rem; }
    button { background: var(--primary); color: #fff; border: none; cursor: pointer; transition: background var(--trans); }
    .link-output input { border: none; background: transparent; color: blue; cursor: text; }
    @media(max-width:768px) {
      .mobile-menu { display: block; }
      aside { transform: translateX(100%); }
      aside.open { transform: translateX(0); }
      main { margin-right: 0; }
    }
  </style>
</head>
<body>
  <button class="mobile-menu" id="menuToggle">☰</button>
  <div class="container">
    <main>
      <section id="dashboard"><h2 class="section-title">الصفحة الرئيسية</h2></section>
      <section id="about"><h2 class="section-title">عنّي</h2></section>
      <section id="skills-overview"><h2 class="section-title">مهاراتي</h2></section>
      <section id="add-skill"><h2 class="section-title">إضافة مهارة جديدة</h2>
        <div class="form-group"><label>اسم المهارة (AR)</label><input id="skillNameAr" placeholder="مثال: جافا سكربت"></div>
        <div class="form-group"><label>اسم المهارة (EN)</label><input id="skillNameEn" placeholder="e.g. JavaScript"></div>
        <div class="form-group"><label>لون المهارة</label><input type="color" id="skillColor" value="#007bff"></div>
        <button id="saveSkillBtn">حفظ المهارة</button>
      </section>
      <section id="current-skills"><h2 class="section-title">المهارات الحالية</h2><div id="skillsList"></div></section>
      <section id="add-work"><h2 class="section-title">إضافة عمل جديد</h2>
        <!-- form groups for work fields -->
        <div class="form-group"><label>العنوان (AR)</label><input id="workTitleAr"></div>
        <div class="form-group"><label>العنوان (EN)</label><input id="workTitleEn"></div>
        <div class="form-group"><label>الوصف (AR)</label><textarea id="workDescAr"></textarea></div>
        <div class="form-group"><label>الوصف (EN)</label><textarea id="workDescEn"></textarea></div>
        <div class="form-group"><label>رابط المعاينة</label><input id="workPreview"></div>
        <div class="form-group"><label>الصورة (URL)</label><input id="workImage"></div>
        <div class="form-group"><label>التصنيف</label><select id="workCategory"></select></div>
        <button id="saveWorkBtn">حفظ العمل</button>
      </section>
      <section id="all-works"><h2 class="section-title">الأعمال الحالية</h2><div id="worksList"></div></section>
      <section id="categories-overview"><h2 class="section-title">تصنيفات الأعمال الحالية</h2><div id="catList"></div></section>
      <section id="add-category"><h2 class="section-title">إضافة تصنيف عمل جديد</h2>
        <div class="form-group"><label>اسم التصنيف (AR)</label><input id="catNameAr"></div>
        <div class="form-group"><label>اسم التصنيف (EN)</label><input id="catNameEn"></div>
        <div class="form-group"><label>أيقونة (URL)</label><input id="catIcon"></div>
        <button id="saveCatBtn">حفظ التصنيف</button>
      </section>
      <section id="upload-section"><h2 class="section-title">قسم الرفع</h2>
        <input type="file" id="fileInput" accept="image/*" style="display:none">
        <button id="uploadBtn">رفع ملف</button>
        <div id="uploadResult" class="link-output"></div>
      </section>
    </main>
    <aside class="sidebar" id="sidebar">
      <h2>لوحة التحكم</h2>
      <ul>
        <li><a data-target="dashboard">الصفحة الرئيسية</a></li>
        <li><a data-target="about">عنّي</a></li>
        <li>
          <a class="has-sub">مهاراتي<span>▶</span></a>
          <ul class="submenu">
            <li><a data-target="add-skill">إضافة مهارة</a></li>
            <li><a data-target="current-skills">المهارات الحالية</a></li>
          </ul>
        </li>
        <li>
          <a class="has-sub">أعمالي<span>▶</span></a>
          <ul class="submenu">
            <li><a data-target="add-work">إضافة عمل</a></li>
            <li><a data-target="all-works">الأعمال الحالية</a></li>
            <li><a data-target="categories-overview">التصنيفات</a></li>
            <li><a data-target="add-category">إضافة تصنيف</a></li>
          </ul>
        </li>
        <li><a data-target="upload-section">قسم الرفع</a></li>
      </ul>
    </aside>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
    const cfg = { apiKey:"AIzaSyCvCUuZPZYU-KvNaALnPC764iTxX5uCKd0", authDomain:"newapp-azyz25.firebaseapp.com", databaseURL:"https://newapp-azyz25-default-rtdb.firebaseio.com", projectId:"newapp-azyz25", storageBucket:"newapp-azyz25.appspot.com", messagingSenderId:"820384444059", appId:"1:820384444059:web:09d81b30b8a14c6603e", measurementId:"G-2Y8RBXXDNX" };
    initializeApp(cfg);
    const db = getDatabase();
    // show section
    const show = id => { document.querySelectorAll('main section').forEach(s=>s.style.display='none'); document.getElementById(id).style.display='block'; };
    // sidebar toggle
    document.getElementById('menuToggle').onclick = ()=> document.getElementById('sidebar').classList.toggle('open');
    document.querySelectorAll('aside a').forEach(a=>a.onclick = ()=>{
      if(a.classList.contains('has-sub')){
        const sub=a.nextElementSibling; sub.style.maxHeight = sub.scrollHeight? null: sub.scrollHeight + 'px'; a.querySelector('span').textContent=sub.scrollHeight? '▶':'▼';
      }
      const t=a.dataset.target; if(t) show(t); if(window.innerWidth<=768) document.getElementById('sidebar').classList.remove('open');
    });
    // upload file
    document.getElementById('uploadBtn').onclick = ()=> document.getElementById('fileInput').click();
    document.getElementById('fileInput').onchange = async ()=>{
      const file = document.getElementById('fileInput').files[0]; if(!file) return;
      const reader = new FileReader(); reader.onload=()=>{
        const token = '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';
        fetch(`https://api.github.com/repos/Azyz25/Portfolio/contents/uploaded/${file.name}`,{
          method:'PUT', headers:{ Authorization:`token ${token}`},
          body: JSON.stringify({ message: `رفع ${file.name}`, content: reader.result.split(',')[1] })
        }).then(r=>r.json()).then(d=>{
          const url=d.content?.download_url; document.getElementById('uploadResult').innerHTML=url? `<input value="${url}" readonly onclick="this.select()">`:'خطأ بالرفع';
        }).catch(e=>console.error(e));
      };
      reader.readAsDataURL(file);
    };
    // skills CRUD
    const skillsRef = ref(db,'skills');
    document.getElementById('saveSkillBtn').onclick=()=>{
      const a=document.getElementById('skillNameAr').value.trim(), e=document.getElementById('skillNameEn').value.trim(), c=document.getElementById('skillColor').value;
      if(!a||!e) return;
      const data={ nameAr:a, nameEn:e, color:c, timestamp:Date.now(), device:navigator.userAgent };
      push(skillsRef).then(()=>alert('تم الحفظ')).catch(console.error);
    };
    const renderSkills = snap=>{
      const el=document.getElementById('skillsList'); el.innerHTML='';
      Object.entries(snap.val()||{}).forEach(([k,v])=>{
        const div=document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.marginBottom='8px';
        div.innerHTML=`<span style="background:${v.color};padding:4px 8px;border-radius:4px;color:#fff;">${v.nameAr}</span>
        <button data-key="${k}">حذف</button>`;
        el.appendChild(div);
        div.querySelector('button').onclick=()=>{ if(confirm('تأكيد الحذف؟')) remove(ref(db,`skills/${k}`)); };
      });
    };
    onValue(skillsRef, renderSkills);
    // initial show
    window.onload = ()=> show('dashboard');
  </script>
</body>
</html>
